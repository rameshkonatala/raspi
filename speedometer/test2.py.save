from time import sleep
import RPi.GPIO as GPIO
import math
from datetime import datetime

GPIO.setmode(GPIO.BOARD)     # set up BCM GPIO numbering

# Set up input pin
GPIO.setup(16, GPIO.IN, pull_up_down=GPIO.PUD_UP)

counter=0
time_interval=[]
# Callback function to run in another thread when button pressed
def rps(channel):
	global time_interval
	
if len(time_interval)==2:
		time_interval[1]=time_interval[0]
		time_interval[0]=datetime.now()
		print (time_interval[0]-time_interval[1]).microseconds
	else:
		time_interval.append(datetime.now())
    
def calculate_speed(r_cm):
	global time_interval
	if len(time_interval)==0 or len(time_interval)==1:
		km_per_hour=0
	else:
		time_diff=time_interval[0]-time_interval[1]
		time_diff=time_diff.microseconds*1.0/(10**len(str(time_diff.microseconds)))
		circ_cm = (2 * math.pi) * r_cm
		dist_km = (circ_cm) / 100000.0 # convert to kilometres
		km_per_sec = (dist_km ) / time_diff
		km_per_hour = km_per_sec * 3600 # convert to distance per hour
	return km_per_hour



# add event listener on pin 16
# event will interrupt the program and call the buttonPressed function
GPIO.add_event_detect(16, GPIO.RISING, callback=rps, bouncetime=100)


while True:
    sleep(1)
    print (calculate_speed(34.0), "kph")
